---
description: 自动修复代码 Skill（定位→修复→自测→回归）
globs:
  - "**/*"
---

## 目标
当你说“修复/优化/跑不起来/报错”时，Agent 按固定流程自动推进，尽量一次性修好。

## 工作流（默认执行）
1) **复现与定位**
- 收集报错：堆栈、日志、触发步骤、期望行为
- 精准定位到文件/函数/配置项（尽量用最小范围搜索）

2) **提出最小修复方案**
- 优先“最小改动”修复（不重构就能解决的，不做重构）
- 明确风险点与兼容性（尤其 Windows、离线/无 VPN 场景）

3) **实现修复**
- 小步提交式修改：一次只改一类问题（例如：缩进错误/配置读取/返回格式兼容）
- 保持与项目约定一致（前端走 `utils/api.js`，后端逻辑放 `backend/services/**`）

4) **自测与验证（自动）**
按问题类型选择最合适的验证方式：
- **启动类问题**：`python -c "import backend.main"` → 启动 uvicorn → 探测 `/docs`
- **接口类问题**：用最小 HTTP 请求验证关键路径（例如 `/chat/voice`、`/tts`）
- **缓存/模型类问题**：验证是否命中缓存、是否触发外网请求、是否能离线加载

5) **回归检查**
- 确认未引入新报错（必要时查看相关文件的 lint）
- 确认“用户体验层面”的行为符合预期（端口、音色、响应时间等）

## 处理原则
- **先修致命问题**：语法/缩进/启动失败 > 逻辑 bug > 体验优化
- **先保可用**：能跑起来、能出结果，再谈更优雅的结构
- **不要引入新依赖**：除非必要且明确说明原因
- **离线优先**：能离线就离线；联网只作为增强

## 交付输出（简洁但完整）
Agent 最终要给出：
- 改了哪些文件、解决了什么
- 你接下来怎么操作（如是否需要重启后端/清空缓存）
- 如果仍有不确定点：列出 1–2 个最关键的确认项（避免来回问太多）


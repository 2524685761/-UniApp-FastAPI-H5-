# 情感伴学国家通用语学习系统 - 技术栈分析

## 一、系统概述

本系统是一个基于**情感识别**的智能语言学习平台，面向民族地区、边境/偏远地区、幼儿等国家通用语学习者。系统通过分析学习者的发音和情绪状态，提供个性化的学习反馈和情感激励。

---

## 二、技术架构

### 2.1 整体架构
- **架构模式**: 前后端分离
- **前端**: UniApp (跨平台移动应用框架)
- **后端**: FastAPI (Python Web框架)
- **数据库**: SQLite (轻量级关系型数据库)
- **通信协议**: RESTful API (HTTP/HTTPS)

---

## 三、前端技术栈

### 3.1 核心框架
| 技术 | 版本/说明 | 用途 |
|------|----------|------|
| **UniApp** | - | 跨平台应用开发框架，支持H5、小程序、App |
| **Vue.js** | Vue 2 | 前端MVVM框架，用于构建用户界面 |
| **JavaScript (ES6+)** | - | 前端编程语言 |

### 3.2 前端特性
- **跨平台支持**: 一套代码可编译到H5、微信小程序、App等多个平台
- **组件化开发**: 使用Vue组件化思想，提高代码复用性
- **响应式设计**: 适配不同屏幕尺寸
- **本地存储**: 使用`uni.getStorageSync`进行数据持久化

### 3.3 前端主要功能模块
- **录音功能**: 使用`uni.getRecorderManager`实现语音录制
- **文件上传**: 使用`uni.uploadFile`上传音频文件
- **音频播放**: 使用`uni.createInnerAudioContext`播放TTS音频
- **路由管理**: 使用`pages.json`配置页面路由和TabBar

---

## 四、后端技术栈

### 4.1 Web框架
| 技术 | 版本 | 用途 |
|------|------|------|
| **FastAPI** | 0.109.0 | 现代、快速的Python Web框架，自动生成API文档 |
| **Uvicorn** | 0.27.0 | ASGI服务器，用于运行FastAPI应用 |
| **Python** | 3.8+ | 后端编程语言 |

### 4.2 数据库与ORM
| 技术 | 版本 | 用途 |
|------|------|------|
| **SQLite** | - | 轻量级文件数据库，无需单独安装 |
| **SQLAlchemy** | 2.0.25 | Python ORM框架，用于数据库操作 |
| **Pydantic** | 2.5.3 | 数据验证和序列化库 |

### 4.3 中间件与工具
| 技术 | 版本 | 用途 |
|------|------|------|
| **CORSMiddleware** | - | 跨域资源共享中间件 |
| **python-multipart** | 0.0.6 | 处理文件上传 |
| **python-jose** | 3.3.0 | JWT令牌处理（预留） |
| **passlib** | 1.7.4 | 密码哈希（预留） |
| **bcrypt** | 4.1.2 | 密码加密（预留） |

---

## 五、AI与音频处理技术栈

### 5.1 语音识别 (ASR)
| 技术 | 版本 | 用途 |
|------|------|------|
| **FunASR** | >=1.0.0 | 阿里达摩院开源的中文语音识别模型 |
| **ModelScope** | >=1.9.0 | 模型管理和下载平台 |
| **paraformer-zh** | v2.0.4 | 轻量级中文语音识别模型 |

**功能**: 将用户录制的语音转换为文字，用于发音评分和文本对比

### 5.2 情感识别
| 技术 | 版本 | 用途 |
|------|------|------|
| **Transformers** | >=4.30.0 | HuggingFace的深度学习模型库 |
| **PyTorch** | >=2.0.0 | 深度学习框架 |
| **TorchAudio** | >=2.0.0 | 音频处理库 |
| **emotion2vec** | - | 语音情感识别模型 |

**功能**: 分析用户语音中的情绪状态（自信、困惑、挫败、平静），用于动态调整学习策略

### 5.3 发音评分
| 技术 | 说明 | 用途 |
|------|------|------|
| **发音评分服务** | 可接入讯飞API或本地算法 | 评估用户发音准确度、流畅度 |

### 5.4 文本转语音 (TTS)
| 技术 | 版本 | 用途 |
|------|------|------|
| **pyttsx3** | 2.90 | 跨平台文本转语音库（使用系统TTS引擎） |
| **FFmpeg** | - | 音频格式转换和处理工具 |

**功能**: 生成标准发音示范音频，提供学习反馈语音

### 5.5 音频处理
| 技术 | 版本 | 用途 |
|------|------|------|
| **pydub** | 0.25.1 | Python音频处理库 |
| **librosa** | >=0.10.0 | 音频特征提取和分析 |
| **numpy** | >=1.24.0 | 数值计算库 |
| **scipy** | >=1.10.0 | 科学计算库 |

**功能**: 
- 音频格式转换（webm → wav/mp3）
- 音频特征提取（音量、时长、静音比例等）
- 音频质量分析

### 5.6 中文处理
| 技术 | 版本 | 用途 |
|------|------|------|
| **pypinyin** | >=0.50.0 | 中文转拼音库 |

**功能**: 为汉字生成拼音标注，辅助学习

---

## 六、大模型API集成（可选）

### 6.1 支持的AI服务商
| 服务商 | API | 用途 |
|--------|-----|------|
| **OpenAI** | GPT-3.5/GPT-4 | AI对话和故事生成 |
| **DeepSeek** | deepseek-chat | 国产大模型，性价比高 |
| **通义千问** | DashScope API | 阿里云大模型服务 |
| **离线模式** | 关键词匹配 + 预设故事库 | 无需API密钥的备用方案 |

### 6.2 HTTP请求
| 技术 | 版本 | 用途 |
|------|------|------|
| **requests** | >=2.31.0 | Python HTTP库，用于调用大模型API |

---

## 七、数据存储

### 7.1 数据库设计
- **users**: 用户表
- **courses**: 课程表（存储课程内容和主题字库）
- **learning_records**: 学习记录表（存储每次练习的评分、情绪、反馈等）

### 7.2 文件存储
- **uploads/**: 存储用户上传的录音文件
- **uploads/tts/**: 存储TTS生成的音频文件（带MD5缓存）

### 7.3 配置文件
- **vocab_categories.json**: 主题字库配置（10个主题，200+词汇）

---

## 八、核心技术亮点

### 8.1 情感自适应学习
- **情绪检测**: 通过AI模型分析用户语音中的情绪
- **策略调整**: 检测到困惑/挫败时，自动放缓节奏、加强示范、鼓励复练
- **个性化反馈**: 根据情绪状态提供不同的鼓励话语

### 8.2 多模态AI分析
- **语音识别**: FunASR识别用户发音内容
- **发音评分**: 评估准确度、流畅度
- **情感识别**: 分析学习者的情绪状态
- **综合反馈**: 结合多维度信息生成个性化建议

### 8.3 跨平台兼容
- **UniApp**: 一套代码多端运行（H5、小程序、App）
- **响应式设计**: 适配不同设备屏幕

### 8.4 离线/在线双模式
- **离线模式**: 无需API密钥，使用关键词匹配和预设故事库
- **在线模式**: 接入真实大模型API，提供更智能的对话体验
- **自动降级**: API失败时自动回退到离线模式

---

## 九、开发工具与环境

### 9.1 开发工具
- **HBuilderX**: UniApp官方IDE（推荐）
- **VS Code**: 代码编辑器
- **Postman/浏览器**: API测试工具

### 9.2 运行环境
- **Python**: 3.8+
- **Node.js**: （UniApp CLI需要）
- **FFmpeg**: 音频处理工具

### 9.3 部署方式
- **后端**: 使用Uvicorn运行，支持热重载
- **前端**: 
  - H5: 可直接在浏览器运行
  - 小程序: 通过HBuilderX编译到微信开发者工具
  - App: 通过HBuilderX打包为原生应用

---

## 十、技术栈总结

### 10.1 前端技术栈
```
UniApp + Vue 2 + JavaScript
```

### 10.2 后端技术栈
```
FastAPI + SQLAlchemy + SQLite + Python
```

### 10.3 AI技术栈
```
FunASR (ASR) + Transformers (情感识别) + PyTorch + pyttsx3 (TTS)
```

### 10.4 可选AI服务
```
OpenAI / DeepSeek / 通义千问 API
```

### 10.5 音频处理
```
pydub + librosa + FFmpeg
```

---

## 十一、技术选型理由

### 11.1 为什么选择UniApp？
- **跨平台**: 一套代码多端运行，降低开发成本
- **生态成熟**: 丰富的组件和插件
- **学习成本低**: 基于Vue.js，易于上手

### 11.2 为什么选择FastAPI？
- **性能优秀**: 基于Starlette和Pydantic，性能接近Node.js
- **自动文档**: 自动生成Swagger/OpenAPI文档
- **类型提示**: 支持Python类型提示，代码更健壮
- **异步支持**: 原生支持异步编程

### 11.3 为什么选择SQLite？
- **轻量级**: 无需单独安装数据库服务
- **文件数据库**: 便于部署和迁移
- **适合原型**: 适合中小型应用和毕业设计

### 11.4 为什么选择FunASR？
- **中文优化**: 专门针对中文语音识别优化
- **开源免费**: 无需API密钥，可离线使用
- **轻量级**: paraformer模型相对较小，适合本地部署

### 11.5 为什么选择Transformers？
- **模型丰富**: HuggingFace提供大量预训练模型
- **易于使用**: Pipeline API简单易用
- **社区活跃**: 文档完善，问题容易解决

---

## 十二、技术难点与解决方案

### 12.1 音频格式兼容
- **问题**: 不同平台录制的音频格式不同（webm、mp3、wav等）
- **解决**: 使用pydub和FFmpeg进行格式转换，统一处理

### 12.2 跨域问题
- **问题**: 前端H5访问后端API存在跨域限制
- **解决**: 使用FastAPI的CORSMiddleware允许跨域请求

### 12.3 模型加载优化
- **问题**: AI模型首次加载较慢，占用内存大
- **解决**: 使用懒加载和全局单例模式，避免重复加载

### 12.4 多线程安全
- **问题**: pyttsx3在多线程环境下可能出现句柄占用
- **解决**: 使用threading.Lock保证线程安全

### 12.5 离线/在线模式切换
- **问题**: API调用可能失败，需要降级处理
- **解决**: 实现自动降级机制，API失败时回退到离线模式

---

## 十三、技术栈版本清单

### 13.1 后端依赖 (requirements.txt)
```
fastapi==0.109.0
uvicorn==0.27.0
sqlalchemy==2.0.25
python-multipart==0.0.6
pydantic==2.5.3
python-jose==3.3.0
passlib==1.7.4
bcrypt==4.1.2
pydub==0.25.1
pyttsx3==2.90
pypinyin>=0.50.0
requests>=2.31.0
```

### 13.2 AI增强依赖 (requirements_ai.txt)
```
funasr>=1.0.0
modelscope>=1.9.0
transformers>=4.30.0
torch>=2.0.0
torchaudio>=2.0.0
numpy>=1.24.0
scipy>=1.10.0
librosa>=0.10.0
websocket-client>=1.6.0
```

---

## 十四、适用场景

### 14.1 毕业设计
- ✅ **技术栈完整**: 涵盖前端、后端、AI、数据库等多个技术领域
- ✅ **功能丰富**: 包含语音识别、情感分析、TTS、AI对话等AI功能
- ✅ **有创新点**: 情感自适应学习是核心亮点
- ✅ **易于演示**: 界面友好，功能直观

### 14.2 实际应用
- **教育场景**: 民族地区、边境地区国家通用语教学
- **幼儿教育**: 3-6岁幼儿普通话学习
- **成人培训**: 普通话水平测试练习

---

## 十五、技术扩展方向

### 15.1 可扩展功能
- **用户系统**: 完善用户注册、登录、权限管理
- **数据可视化**: 使用ECharts展示学习数据统计
- **社交功能**: 学习排行榜、好友PK等
- **内容管理**: 后台管理系统，动态管理课程内容

### 15.2 可优化技术
- **数据库**: 迁移到PostgreSQL或MySQL，支持更大规模
- **缓存**: 引入Redis缓存，提升性能
- **消息队列**: 使用Celery处理异步任务（如TTS生成）
- **容器化**: 使用Docker部署，便于运维

---

## 十六、总结

本系统采用**前后端分离**架构，前端使用**UniApp + Vue.js**实现跨平台应用，后端使用**FastAPI**提供RESTful API服务，数据库使用**SQLite**存储数据。核心AI功能包括**FunASR语音识别**、**Transformers情感识别**、**pyttsx3文本转语音**等，并支持接入**OpenAI/DeepSeek/通义千问**等大模型API。

系统技术栈**完整、现代、实用**，适合作为毕业设计项目，也具备实际应用价值。

---

**文档生成时间**: 2024年
**系统版本**: v1.0.0

